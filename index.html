<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å‡ºè·QRç…§åˆã‚·ã‚¹ãƒ†ãƒ </title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }
    h1 {
      background: #333;
      color: white;
      padding: 10px;
    }
    .scanner-container {
      display: flex;
      justify-content: space-around;
      margin: 10px;
    }
    .scanner {
      width: 45%;
    }
    #result {
      font-size: 1.5em;
      margin-top: 20px;
      padding: 10px;
      background: #fff;
      border-radius: 8px;
      display: inline-block;
    }
    .ok { color: green; }
    .ng { color: red; }
  </style>
</head>
<body>
  <h1>ğŸ“¦ å‡ºè·QRç…§åˆã‚·ã‚¹ãƒ†ãƒ </h1>

  <div class="scanner-container">
    <div class="scanner">
      <h3>æ‰‹å…ƒãƒªã‚¹ãƒˆQRï¼ˆDåˆ—ï¼‰</h3>
      <div id="scanner-dqr" style="width:100%;"></div>
    </div>
    <div class="scanner">
      <h3>è£½å“è²¼ä»˜QRï¼ˆEåˆ—ï¼‰</h3>
      <div id="scanner-productqr" style="width:100%;"></div>
    </div>
  </div>

  <div id="result">QRã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„</div>

  <script>
    let dqr = null;
    let productqr = null;

    const dqrScanner = new Html5Qrcode("scanner-dqr");
    const productScanner = new Html5Qrcode("scanner-productqr");

    function startScanners() {
      dqrScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 150 }, qr => {
        dqr = qr;
        dqrScanner.stop();
        checkMatch();
      });

      productScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 150 }, qr => {
        productqr = qr;
        productScanner.stop();
        checkMatch();
      });
    }

    function checkMatch() {
      if (dqr && productqr) {
        fetch("https://script.google.com/macros/s/AKfycbz1p34F3mNIE0-1iFP0N1GAf3Qujsqded31x2cw87Pyl1FHdWCLtpDyDH2Dy0ikIu5FPA/exec", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `dp=${encodeURIComponent(dqr)}&productQr=${encodeURIComponent(productqr)}`
        })
        .then(res => res.text())
        .then(result => {
          const resultBox = document.getElementById("result");
          resultBox.textContent = result;
          resultBox.className = result.includes("OK") ? "ok" : "ng";

          // 3ç§’å¾Œã«ãƒªã‚»ãƒƒãƒˆï¼†å†ã‚¹ã‚­ãƒ£ãƒ³
          setTimeout(() => {
            dqr = null;
            productqr = null;
            resultBox.textContent = "QRã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„";
            resultBox.className = "";
            startScanners();
          }, 3000);
        });
      }
    }

    // åˆå›èµ·å‹•
    startScanners();
  </script>
</body>
</html>
